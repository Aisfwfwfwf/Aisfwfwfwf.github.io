<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сырниковый Рай</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: #ffffff;
            color: #222222;
            padding: 10px;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
        }
        
        .header h1 {
            font-size: 22px;
            margin-bottom: 5px;
            color: #222222;
        }
        
        .header p {
            color: #666666;
            font-size: 14px;
        }
        
        .banner {
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .banner img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .products {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 80px;
        }
        
        .product-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }
        
        .product-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .product-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .product-description {
            color: #666666;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .product-price {
            font-weight: bold;
            color: #40a7e3;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .product-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            background: #40a7e3;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        .quantity {
            font-weight: 600;
            font-size: 14px;
            min-width: 20px;
        }
        
        .cart-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .cart-button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: #40a7e3;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
        }
        
        .cart-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .cart-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-total {
            font-weight: bold;
            text-align: right;
            margin: 15px 0;
            font-size: 18px;
        }
        
        .order-button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: #40a7e3;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        
        .close-cart {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 10px;
            background: #f0f0f0;
            color: #222222;
            cursor: pointer;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f8f8;
            font-size: 16px;
        }
        
        .input-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .cart-empty {
            text-align: center;
            color: #999;
            padding: 20px;
            font-style: italic;
        }
        
        .check-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
        }
        
        .check-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 80vh;
            overflow: auto;
            text-align: center;
        }
        
        .check-text {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Сырниковый Рай</h1>
        <p>Вкуснейшие сырники с доставкой</p>
    </div>

    <div class="banner">
        <img src="https://github.com/Aisfwfwfwf/Aisfwfwfwf.github.io/raw/main/logo.jpg" alt="Сырниковый Рай" onerror="this.src='https://img.freepik.com/free-photo/plate-with-tasty-cheesecakes-sour-cream_2829-12060.jpg'">
    </div>

    <div class="products" id="productsList">
        <!-- Товары будут здесь -->
    </div>

    <div class="cart-footer">
        <button class="cart-button" id="cartButton">Корзина (0) | 0 руб.</button>
    </div>

    <div class="cart-popup" id="cartPopup">
        <div class="cart-content">
            <h2>Ваша корзина</h2>
            <div class="cart-items" id="cartItems"></div>
            <div class="cart-total">Итого: <span id="totalPrice">0</span> руб.</div>
            <button class="order-button" id="orderButton">Оформить заказ</button>
            <button class="close-cart" id="closeCart">Закрыть</button>
        </div>
    </div>

    <div class="cart-popup" id="orderPopup">
        <div class="cart-content">
            <h2>Оформление заказа</h2>
            <div class="input-group">
                <label for="userName">Ваше имя:</label>
                <input type="text" id="userName" required placeholder="Как к вам обращаться?">
            </div>
            
            <div class="input-group">
                <label for="userPhone">Телефон:</label>
                <input type="tel" id="userPhone" required placeholder="+7 (900) 123-45-67">
            </div>
            
            <div class="input-group">
                <label>Способ получения:</label>
                <select id="deliveryType" required>
                    <option value="" disabled selected>Выберите способ</option>
                    <option value="delivery">Доставка (+200 руб.)</option>
                    <option value="pickup">Самовывоз</option>
                </select>
            </div>
            
            <div class="input-group" id="addressField" style="display: none;">
                <label for="userAddress">Адрес доставки:</label>
                <input type="text" id="userAddress" placeholder="Улица, дом, квартира">
            </div>
            
            <div class="input-group">
                <label for="userComment">Комментарий к заказу:</label>
                <textarea id="userComment" placeholder="Например: позвонить за час до доставки"></textarea>
            </div>
            
            <div class="cart-total">Итого к оплате: <span id="finalPrice">0</span> руб.</div>
            
            <button class="order-button" id="confirmOrderButton">Подтвердить заказ</button>
            <button class="close-cart" id="backToCartButton">Назад в корзину</button>
        </div>
    </div>

    <script>
        // Простые данные товаров
        const products = [
            {
                id: 1,
                name: "Классические сырники",
                description: "С нежной сметаной и ванилью",
                price: 250,
                image: "https://github.com/Aisfwfwfwf/Aisfwfwfwf.github.io/raw/main/1.jpg"
            },
            {
                id: 2,
                name: "Сырники с шоколадом", 
                description: "С кусочками черного шоколада",
                price: 280,
                image: "https://github.com/Aisfwfwfwf/Aisfwfwfwf.github.io/raw/main/2.jpg"
            },
            {
                id: 3,
                name: "Сырники с изюмом",
                description: "Сочные с виноградным изюмом",
                price: 270,
                image: "https://github.com/Aisfwfwfwf/Aisfwfwfwf.github.io/raw/main/3.jpg"
            },
            {
                id: 4,
                name: "Веганские сырники",
                description: "На кокосовых сливках без яиц",
                price: 300,
                image: "https://github.com/Aisfwfwfwf/Aisfwfwfwf.github.io/raw/main/4.jpg"
            }
        ];

        let cart = {};
        const deliveryCost = 200;
        const botUsername = 'your_cheesecake_bot'; // ЗАМЕНИТЕ НАСТОЯЩИЙ USERNAME БОТА БЕЗ @

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            renderProducts();
            setupEventListeners();
            updateCart();
            
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.expand();
            }
        });

        function renderProducts() {
            const productsList = document.getElementById('productsList');
            productsList.innerHTML = '';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="product-image" 
                         onerror="this.src='https://via.placeholder.com/150/4ECDC4/FFFFFF?text=Сырники'">
                    <div class="product-title">${product.name}</div>
                    <div class="product-description">${product.description}</div>
                    <div class="product-price">${product.price} руб.</div>
                    <div class="product-controls">
                        <button class="quantity-btn" onclick="changeQuantity(${product.id}, -1)">-</button>
                        <span class="quantity" id="quantity-${product.id}">0</span>
                        <button class="quantity-btn" onclick="changeQuantity(${product.id}, 1)">+</button>
                    </div>
                `;
                productsList.appendChild(productCard);
            });
        }

        function setupEventListeners() {
            // Корзина
            document.getElementById('cartButton').addEventListener('click', () => {
                document.getElementById('cartPopup').style.display = 'flex';
            });

            document.getElementById('closeCart').addEventListener('click', () => {
                document.getElementById('cartPopup').style.display = 'none';
            });

            document.getElementById('orderButton').addEventListener('click', () => {
                document.getElementById('orderPopup').style.display = 'flex';
            });

            document.getElementById('backToCartButton').addEventListener('click', () => {
                document.getElementById('orderPopup').style.display = 'none';
            });

            document.getElementById('confirmOrderButton').addEventListener('click', processOrder);

            document.getElementById('deliveryType').addEventListener('change', function() {
                document.getElementById('addressField').style.display = 
                    this.value === 'delivery' ? 'block' : 'none';
                calculateFinalTotal();
            });

            // Клик вне попапов
            [document.getElementById('cartPopup'), document.getElementById('orderPopup')].forEach(popup => {
                popup.addEventListener('click', (e) => {
                    if (e.target === popup) {
                        popup.style.display = 'none';
                    }
                });
            });
        }

        function changeQuantity(productId, delta) {
            if (!cart[productId]) cart[productId] = 0;
            cart[productId] += delta;
            
            if (cart[productId] < 0) cart[productId] = 0;
            
            updateProductQuantity(productId);
            updateCart();
        }

        function updateProductQuantity(productId) {
            const quantityElement = document.getElementById(`quantity-${productId}`);
            if (quantityElement) {
                quantityElement.textContent = cart[productId] || 0;
            }
        }

        function updateCart() {
            let total = 0;
            let totalCount = 0;
            
            for (const productId in cart) {
                if (cart[productId] > 0) {
                    const product = products.find(p => p.id == productId);
                    if (product) {
                        total += product.price * cart[productId];
                        totalCount += cart[productId];
                    }
                }
            }
            
            document.getElementById('cartButton').textContent = `Корзина (${totalCount}) | ${total} руб.`;
            renderCartItems();
            document.getElementById('totalPrice').textContent = total;
            document.getElementById('finalPrice').textContent = total;
        }

        function renderCartItems() {
            const cartItems = document.getElementById('cartItems');
            cartItems.innerHTML = '';
            let isEmpty = true;
            
            for (const productId in cart) {
                if (cart[productId] > 0) {
                    isEmpty = false;
                    const product = products.find(p => p.id == productId);
                    if (product) {
                        const cartItem = document.createElement('div');
                        cartItem.className = 'cart-item';
                        cartItem.innerHTML = `
                            <div>
                                <div>${product.name}</div>
                                <div>${product.price} руб. x ${cart[productId]}</div>
                            </div>
                            <div>${product.price * cart[productId]} руб.</div>
                        `;
                        cartItems.appendChild(cartItem);
                    }
                }
            }
            
            if (isEmpty) {
                cartItems.innerHTML = '<div class="cart-empty">Корзина пуста</div>';
                document.getElementById('orderButton').style.display = 'none';
            } else {
                document.getElementById('orderButton').style.display = 'block';
            }
        }

        function calculateFinalTotal() {
            let productsTotal = parseInt(document.getElementById('totalPrice').textContent) || 0;
            let delivery = document.getElementById('deliveryType').value === 'delivery' ? deliveryCost : 0;
            let finalTotal = productsTotal + delivery;
            
            document.getElementById('finalPrice').textContent = finalTotal;
            return finalTotal;
        }

        function validateForm() {
            const userName = document.getElementById('userName').value.trim();
            const userPhone = document.getElementById('userPhone').value.trim();
            const deliveryType = document.getElementById('deliveryType').value;
            const userAddress = document.getElementById('userAddress').value.trim();
            
            if (!userName) {
                alert('Пожалуйста, укажите ваше имя');
                return false;
            }
            
            if (!userPhone) {
                alert('Пожалуйста, укажите ваш телефон');
                return false;
            }
            
            if (!deliveryType) {
                alert('Пожалуйста, выберите способ получения');
                return false;
            }
            
            if (deliveryType === 'delivery' && !userAddress) {
                alert('Пожалуйста, укажите адрес доставки');
                return false;
            }

            return true;
        }

        function processOrder() {
            if (!validateForm()) return;

            const orderData = {
                products: [],
                total: calculateFinalTotal(),
                deliveryType: document.getElementById('deliveryType').value,
                deliveryCost: document.getElementById('deliveryType').value === 'delivery' ? deliveryCost : 0,
                customer: {
                    name: document.getElementById('userName').value.trim(),
                    phone: document.getElementById('userPhone').value.trim(),
                    address: document.getElementById('userAddress').value.trim() || 'Самовывоз',
                    comment: document.getElementById('userComment').value.trim()
                },
                timestamp: new Date().toLocaleString('ru-RU'),
                orderId: 'CH' + Date.now().toString().slice(-6)
            };
            
            for (const productId in cart) {
                if (cart[productId] > 0) {
                    const product = products.find(p => p.id == productId);
                    if (product) {
                        orderData.products.push({
                            id: product.id,
                            name: product.name,
                            quantity: cart[productId],
                            price: product.price
                        });
                    }
                }
            }

            // Показываем чек
            showCheck(orderData);
        }

        function showCheck(orderData) {
            const checkText = formatCheckText(orderData);
            
            const modal = document.createElement('div');
            modal.className = 'check-modal';
            modal.innerHTML = `
                <div class="check-content">
                    <h3 style="color: #27ae60; margin-bottom: 15px;">✅ Заказ оформлен!</h3>
                    
                    <div class="check-text">
                        ${checkText}
                    </div>
                    
                    <p style="color: #666; margin: 15px 0;">
                        📋 Чек скопирован! Отправьте его боту для подтверждения
                    </p>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 15px;">
                        <button onclick="copyCheck()" style="
                            background: #3498db;
                            color: white;
                            border: none;
                            padding: 12px 20px;
                            border-radius: 8px;
                            cursor: pointer;
                        ">
                            📋 Скопировать чек
                        </button>
                        
                        <button onclick="openBot()" style="
                            background: #27ae60;
                            color: white;
                            border: none;
                            padding: 12px 20px;
                            border-radius: 8px;
                            cursor: pointer;
                        ">
                            💬 Открыть бота
                        </button>
                    </div>
                    
                    <button onclick="closeCheck()" style="
                        background: #95a5a6;
                        color: white;
                        border: none;
                        padding: 10px 15px;
                        border-radius: 8px;
                        cursor: pointer;
                        width: 100%;
                    ">
                        Закрыть
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Копируем автоматически
            copyCheck();
        }

        function formatCheckText(orderData) {
            const productsList = orderData.products.map(p => 
                `• ${p.name} × ${p.quantity} = ${p.quantity * p.price} руб.`
            ).join('\n');

            return `
🍰 ЧЕК ЗАКАЗА #${orderData.orderId}
━━━━━━━━━━━━━━━━━━━━
👤 КЛИЕНТ: ${orderData.customer.name}
📞 ТЕЛЕФОН: ${orderData.customer.phone}
📍 ${orderData.deliveryType === 'delivery' ? 'ДОСТАВКА' : 'САМОВЫВОЗ'}

${orderData.deliveryType === 'delivery' ? `🏠 АДРЕС: ${orderData.customer.address}\n` : ''}
🛒 ЗАКАЗ:
${productsList}
━━━━━━━━━━━━━━━━━━━━
💵 СУММА: ${orderData.total - orderData.deliveryCost} руб.
🚗 ДОСТАВКА: ${orderData.deliveryCost} руб.
💰 ИТОГО: ${orderData.total} руб.

📝 КОММЕНТАРИЙ: ${orderData.customer.comment || 'нет'}
🕒 ВРЕМЯ: ${orderData.timestamp}
━━━━━━━━━━━━━━━━━━━━
            `.trim();
        }

        function copyCheck() {
            const checkText = document.querySelector('.check-text pre')?.textContent || 
                             document.querySelector('.check-text')?.textContent;
            
            if (!checkText) return;
            
            try {
                navigator.clipboard.writeText(checkText).then(() => {
                    alert('✅ Чек скопирован в буфер обмена!');
                }).catch(() => {
                    // Fallback для старых браузеров
                    const textarea = document.createElement('textarea');
                    textarea.value = checkText;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    alert('✅ Чек скопирован!');
                });
            } catch (error) {
                alert('❌ Не удалось скопировать. Выделите текст и скопируйте вручную.');
            }
        }

        function openBot() {
            window.open(`https://t.me/${botUsername}`, '_blank');
        }

        function closeCheck() {
            const modal = document.querySelector('.check-modal');
            if (modal) {
                modal.remove();
            }
            // Очищаем корзину
            cart = {};
            updateCart();
            document.getElementById('orderPopup').style.display = 'none';
            document.getElementById('cartPopup').style.display = 'none';
            
            // Очищаем форму
            document.getElementById('userName').value = '';
            document.getElementById('userPhone').value = '';
            document.getElementById('userAddress').value = '';
            document.getElementById('userComment').value = '';
            document.getElementById('deliveryType').selectedIndex = 0;
            document.getElementById('addressField').style.display = 'none';
        }
    </script>
</body>
</html>
